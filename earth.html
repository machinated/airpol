<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My first three.js app</title>
    <style>
        body { margin: 0; }
        canvas { width: 100%; height: 100% }
    </style>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="earth.css" />
</head>
<body>

<div id="info"></div>

<script src="js/three.min.js"></script>
<script>
    var scene, camera, renderer;
    var radius = 1;
    var zoom = 1;
    var info = $("#info");
    var mousePos = {
        x: 0,
        y: 0
    };
    var mouseDelta = {
        x: 0,
        y: 0
    };

    init();
    animate();

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.001, 1000);
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        var loader = new THREE.TextureLoader();
        loader.load( 'textures/world4096x2048.jpg', function ( texture ) {

            var geometry = new THREE.SphereGeometry(radius, 48, 36);

            var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 } );
            var mesh = new THREE.Mesh( geometry, material );
            scene.add( mesh );
        } );

        // wireframe sphere
        var geometry = new THREE.SphereGeometry(radius * 1.02, 24, 18);
        var material = new THREE.MeshBasicMaterial( {
            color: 0x3377ff,
            wireframe: true
        } );
        var sphere = new THREE.Mesh( geometry, material );
        scene.add(sphere);

        camera.spherical = new THREE.Spherical(2, Math.PI/4, Math.PI/2);
        updateZoom();

        document.addEventListener("mousemove", onDocumentMouseMove, false);
        document.addEventListener("wheel", onDocumentWheel, false);
        updateCamera();
    }

    function animate() {
        requestAnimationFrame(animate);

        render();
    }

    function render() {
        updateInfo();
        renderer.render(scene, camera);
    }

    function updateCamera() {
        camera.spherical.makeSafe();
        camera.position.setFromSpherical(camera.spherical);
        camera.lookAt( scene.position );
    }

    function updateZoom() {
        zoom = Math.max(0, Math.min(10, zoom));
        camera.height = Math.pow(0.5, zoom);
        camera.spherical.radius = radius + camera.height;
        updateCamera();
    }

    function updateInfo() {
        info.html("Phi: " + camera.spherical.phi.toString() + "<br />Theta: " + camera.spherical.theta.toString() +
            "<br />Zoom: " + zoom);
    }

    function onDocumentMouseMove(event) {
        event.preventDefault();

        mouseDelta.x = event.clientX - mousePos.x;
        mouseDelta.y = event.clientY - mousePos.y;

        if (event.buttons === 1) {
            camera.spherical.theta -= mouseDelta.x * camera.height * 0.5 / 360;
            camera.spherical.phi -= mouseDelta.y * camera.height * 0.5 / 360;
            //camera.spherical.phi = Math.min(180, Math.max(-180, camera.spherical.phi));

            updateCamera();
        }

        if (event.buttons === 4) {
            zoom -= mouseDelta.y / 200;
            updateZoom();
        }

        mousePos.x = event.clientX;
        mousePos.y = event.clientY;
    }

    function onDocumentWheel(event) {
        event.preventDefault();

        var scroll = event.deltaY;
        if (scroll !== 0) {
            zoom -= scroll / 100;
            updateZoom();
        }
    }
</script>
</body>
</html>